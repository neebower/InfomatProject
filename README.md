# README #

### Readme для репозитория Infomat ###

* Здесь отражается вся текущая информация по ходу проекта (жалкое подобие документации)

### Приветствуются комментарии, предложения и замечания! ###

### Текущее состояние ###

* Проект Cefsharp взят за основу встроенного браузера. Cefsharp реализует поддержку встраивания WebKit браузера Chromium в WPF приложения. Это хорошая альтернатива встраиванию стандартного IE браузера как в плане поддержки WEB -- стандартов, так и кастомизации и скорости работы (а вот это нужно проверить еще).

* WPF приложение настроено на полноэкранный режим

* Не решена проблема со скроллом. Предложено решение - на стороне вёрстки страниц внедрять настройки отображения скролла для WebKit.

* Решена проблема с открытием нового окна при переходах (при открытии страницы в новой вкладке). Теперь страница открывается в том же браузерном контроле (медленно?). Для решения переопределена реализация метода, срабатывающая при открытии в новом окне, путем реализации интерфейса. UPDATE! Проблема не решена! Открываются новые окна! **SOLVED**

* Не решена проблема с запретом нажатия правой кнопки мыши. Нужно запретить нажатие, отображение исходного кода страницы и вообще всплывающего меню. UPDATE!
Solution is:
Browser.MenuHandler = new CustomMenuHandler();
class CustomMenuHandler:IContextMenuHandler **SOLVED**

* Не решена проблема с запретом на нажатие кнопок. Нужно запретить все комбинации клавиш. Только не понятно пока как закрывать приложение. Кнопки закрыть - нет, ALT + F4 не должен работать. Дать кнопку выхода из приложения оператору?

* Нужно протестировать отображение PDF. ***Смотрел pdf с сайта КФУ, отображаются как в обычном хроме. Никита*** Через просмотр pdf можно вылезти на печать документа и его сохранения. Это не круто!

* Нужно настроить кеширование (установить папку, очистку кеша и т.д.)

* Авторизация и аутентификация. https://habrahabr.ru/company/dataart/blog/262817/

* РЕШИТЬ ВОПРОС С ОБНОВЛЕНИЕМ БРАУЗЕРА! Заказчик хочет иметь возможность установки обновлений браузера, закрывающие дыры в безопасности. Как обновлять Chromium?
**UPDATE**: нужно проанализировать зависимости от Chromium, постараться максимально изолировать приложение от DLL встраиваемого браузера (в идеале, чтобы можно было заменить браузер на другой). **UPDATE 2: Заказчик утвердил Chromium в качестве браузера. По поводу обновления, подойдёт даже пересборка приложения**

* Получить дизайн-макет от заказчика и привести приложение в соответствие с ним.

* Получить от заказчика DLL для работы с устройствами и протестировать работу с ними
https://drive.google.com/folderview?id=0ByEJISbmbI3hU1lmMk9YRDZURzA&usp=sharing
Проблема! DLL не документирована. Информация по ней доступна только через её разработчика и то, только по конкретным вопросам. Беда!

* Получены от заказчика дизайн-макеты. Теперь понятно к чему киоску Full HD экран (от перевёрнут). Не понятно что из предоставленного макета относится к приложению, а что к АИС. Соответствующий вопрос задан представителю Заказчика. **Уточнение: Всё будет на стороне информационной системы (портала). Нам нужно только придумать как подружить портал со считыванием карточки**

* Виртуальная клавиатура! Какую использовать? Есть ли контрол для WPF? Как перехватывать ввод в поля и показывать виртуальную клавиатуру? try handle CefRenderProcessHandler.OnFocusedNodeChanged UPDATE: Заказчик будет реализовывать клавиатуру на стороне вёрстки. Пример http://92.53.101.102/schedule.html
**Нужно будет протестировать клавиатуру в тач режиме на инфомате.**
UPDATE: Виртуальная клавиатура протестирована - всё ок.

* Проблема - привезли инфомат с ненастроенной тач панелью. Нужно проверить драйвера и произвести калибровку. UPDATE: Связались с инженером, установили драйвер, откалибровали тач-панель.

* Нужно произвести оптимизацию системы под тач управление. Курсор спрятан, нужно настроить скролл. UPDATE: Курсор прячем на стороне приложения, скроллбары отключаем на вёрстке, с помощью dragscroll. Решение согласовано

* Протестировать работу приложения на инфомате. Проверить отображение портала АИС Инфомат.
UPDATE: Приложение протестировано. Выявлена проблема с появлением скроллбаров даже в том случае, когда размеры страницы и окна браузера точно совпадают. Решили прятать скроллбары overflow:hidden на стороне вёрстки. 

* Протестировать средства для создания инсталлятора Visual Studio. 
UPDATE: Протестированы средства создания инсталляторов. Всё работает нормально. Нужно проанализировать возможности развёртывания через доменные политики.

* Нужно производить настройку ОС инфомата для работы в режиме киоска. При перезагрузке должен автоматически осуществляться вход в систему и загружаться приложение на весь экран. Все настройки должны производиться при развёртывании приложения.

* На 08.07 считаем что основные (известные) шаги реализации встроенного браузера для отображения АИС Инфомат выполнены. Произведена настройка окна приложения для отображения в полноэкранном режиме (отключен заголовок окна и кнопки управления), заблокированы нежелательные действия (запрещено открытие страниц в новых окнах, заблокированы некоторые комбинации клавиш, отключен диспетчер задач). Выбран вариант браузера для встраивания - Chromium через CefSharp. Предложено решение для взаимодействие с АИС Инфомат через тач интерфейс (отключаем курсор, на стороне вёрстки прячем скроллбары, разрешаем перетаскивание элементов с возможностью прокрутки перетаскиванием с помощью dragscroll).

* Работа со считывателем смарт-карт.
DLL считывателя не документирована. Информации для работы катастрофически не хватает и это сильно тормозит процесс разработки.
На 08.07 получилось подключиться к считывателю и, если карта подсоединена, подать питание на неё. Также попробовали запросить UID, получили ответ, но непонятно пока какой. Нужно разобраться в деталях и формате кодирования UID.

* 11.07 В приложении планируется работать с различными PDF документами (могут быть даже формата A2). Так что нужно перетаскивание. Решили переложить возможность отображения PDF на сторону вёрстки. Выбрали решение https://mozilla.github.io/pdf.js/web/viewer.html
Его довольно просто настраивать. !!Также нужно будет добавлять панель навигации в подвал страницы с PDF!! Нужно также предусмотреть возможность масштабирования документов.

* 11.07 Разобрались со считыванием данных с карты. Также были рассмотрены "экстремальные" варианты взаимодействия пользователя с картой (прикладывание к считывателю на слишком короткое время). Исключили возможность возникновения ошибки посреди последовательности действий по считыванию. Нужно перепроверить формат считывания UID и желательно утвердить решение с разработчиком DLL.

* 11.07 Для взаимодействия АИС Инфомат и приложения было предложено решение по развёртыванию механизма считывания данных с карты в локальном сервисе, к которому будет обращаться АИС Инфомат. Рассматриваются протоколы взаимодействия между клиентом и сервисами.

* Комментарий технической переписки от 12.07
Текущая версия верстки на тест-сервер (http://92.53.101.102). 

* 12.07 В технической переписке с разработчиками АИС Инфомат было предложено выделить два события (приложена карта, убрана карта) и запрос (событие?) получен (получить?) id карты.
Обработку предложено производить в javascript функции.
Нужно вызывать событие на веб-странице со стороны приложения.

* 12.07 Рассмотрели возможности двустороннего взаимодействия веб-страницы и приложения. Отработали механизмы вызова js функций из приложения и вызова C# кода со страницы.

* 15.07 У CefSharp последняя стабильная версия 51.0.0

* 16.07 Нужно разделить проекты приложения, браузера и управления устройствами. Получилось разделить приложение и браузер. Предстоит разделение браузера и считывателя карт.

* 17.07 Нужно получать уникальный идентификатор компьютера для того, чтобы на сервере могли по нему проверить какой контент показывать на конкретном инфомате (планируют два варианта - полнофункциональный и урезанный). Есть такое решение http://www.codeproject.com/Articles/28678/Generating-Unique-Key-Finger-Print-for-a-Computer Нужно посмотреть, уникально ли оно и на каких железках основано, не изменяется ли при изменении периферии (мыши, клавиатуры, флешки и т.д.)